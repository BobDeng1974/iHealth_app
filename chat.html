<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
	</head>

	<body>
		<!--顶部搜索框-->
		<header class="mui-bar mui-bar-nav">
            <div class="mui-bar mui-bar-standard">
                <div class="mui-input-row mui-search">
             		<input id="search" type="search" class="mui-input-clear" placeholder="搜索 医生/朋友">
                </div>
            </div>
        </header>
        
        <!--弹出菜单 (默认隐藏)-->
        <div style="text-align: center;">
			<div id="popover" class="mui-popover" style="width:50%;margin:0 auto;text-align: center;">
			  	<ul id="searchResult" class="mui-table-view">
				</ul>
			</div>
        </div>
		
		<!--好友列表-->
		<div class="mui-content mui-scroll-wrapper" id="home">
	        <div class="mui-scroll">
				<div class="mui-card">
					<div class="mui-card-header mui-card-media" style="height: 70px;">
						<img src="./images/logo.png" style="height: 100%;width: auto;"/>
						<div class="mui-media-body" style="padding: 8px 15px;">
							<span style="font-size: 20px;">杨英明</span>
							<p>发表于 2016-06-30 15:30</p>
						</div>
					</div>
				</div>
	        </div>
		</div>
		
		<!--HTML模板（弹出菜单）-->
		<script id="search-template" type="text/html">
			{{ each items item }}
	    	<li class="mui-table-view-cell"><a href="#">{{item.name}}</a></li>
	    	{{ /each }}
    	</script>
		
		<script src="js/mui.min.js"></script>
		<script src="js/template-web.js"></script>
		<script src="js/app.js"></script>
		<script type="text/javascript">
			mui.init()
			
			mui.plusReady(function(){
		     	// 监听滑动事件
		     	var changeTab = function(curTab, targetTab, targetTabTitle){
		      		var curWebview = plus.webview.currentWebview();		     		
		      		var targetWebview = plus.webview.getWebviewById(targetTab);
		      		targetWebview.show();
		      		curWebview.hide();
					// 获取当前页面的父页面（创建它的页面）
					var index = plus.webview.getLaunchWebview();
//					var index = curWebview.opener();
		      		// 在父页面执行JS，激活父页面中对应选择卡，修改标题
					index.evalJS("document.getElementById('chat.html').classList.remove('mui-active');document.getElementById('" + targetTab + "').classList.add('mui-active');document.getElementById('title').innerHTML='" + targetTabTitle + "';");
		     	};
		      	document.querySelector('body').addEventListener('swipeleft',function(e){
		      		changeTab('chat.html','setting.html','设置');
		      	});
		      	document.querySelector('body').addEventListener('swiperight',function(e){
		      		changeTab('chat.html','home.html','首页');
		      	});
		      	
		      	// 监听搜索框输入事件
		      	var searchInput = document.getElementById('search');
		      	searchInput.addEventListener('input', function(e){
		      		// 获取搜索框内容
		      		var name = searchInput.value;
		      		// 输入空串不做处理
		      		if (name.replace(/^\s\s*/, '').replace(/\s\s*$/, '') === ''){
		      			mui('#popover').popover('hide');
		      			return ;
		      		}
		      		// 先隐藏之前的弹出菜单
		      		mui('#popover').popover('hide');
		      		// 模糊匹配指定用户名
					mui.getJSON('http://ihealth.yangyingming.com/api/v1/userlist?name=' + name + '&limit=10',function(data){
						var searchResult = document.getElementById('searchResult');
						// 根据模板将数据渲染成 HTML
						var html = template('search-template', {'items':data});
						if (html.replace(/^\s\s*/, '').replace(/\s\s*$/, '') === ''){
							html = '<li class="mui-table-view-cell"><a href="#">没有找到这个人耶</a></li>'; 
						}
						// 将HTML插入到弹出菜单中
						searchResult.innerHTML = html;
//		      			mui('#popover').popover('toggle',document.getElementById("popover"));
						// 显示弹出菜单
		      			mui('#popover').popover('show');
					});
		      	});
			});
		</script>
	</body>

</html>