<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
	</head>

	<body>
		<!--内容-->
		<div class="mui-content" id="home">
		</div>

		<!--引用的 JS-->
		<script src="js/mui.min.js"></script>
		<script src="js/template-web.js"></script>
		
		<!--HTML模板-->
		<script id="home-template" type="text/html">
			{{each items item}}
				<div class="mui-card">
					<!--页眉，放置标题-->
					<div class="mui-card-header mui-card-media">
						<img src="./images/logo.png" />
						<div class="mui-media-body">
							{{item.publisher}}
							<p>发表于 {{item.pubdate}}</p>
						</div>
					</div>
					<!--内容区-->
					<div class="mui-card-content" style="padding:10px;">
						<h4>{{item.title}}</h4>
						<img alt="{{item.title}}" src="{{item.img}}" style="width: 100%;padding:4px 16px 2px 2px;" />
						{{item.intro}}
					</div>
					<!--页脚，放置补充信息或支持的操作-->
					<div class="mui-card-footer">
						<a class="mui-card-link">点赞</a>
						<a class="mui-card-link">评论</a>
						<a class="mui-card-link" onclick="readMore(this)" id="{{item._id}}">阅读更多</a>
					</div>
				</div>
			{{/each}}
		</script>
		
		<!--JS代码-->
		<script type="text/javascript">
			mui.init();
			function readMore(e){
				var id = e.getAttribute('id');
				// 获得文章详情页面 webview
				articlePage = plus.webview.getWebviewById('article.html');
				// 注入数据
				mui.fire(articlePage,'currentId',{
					id:id
				});
				// 打开详情页面
				mui.openWindow({
					url:'article.html',
					id:'article.html'
				});
			};
			mui.plusReady(function(){
				// 渲染
				// 从后端获取数据
				mui.getJSON('http://ihealth.yangyingming.com/api/v1/articlelist',function(data){
					// 根据模板将数据渲染成 HTML
					var html = template('home-template', {'items':data});
					// 将 HTML 插入到页面中
					document.getElementById('home').innerHTML = html;
				});
				
			    //预加载详情页
			    webview_article = mui.preload({
			        url: 'article.html',
			        id: 'article.html',
			        styles: {
			            "render": "always",//一直渲染
			            "popGesture": "hide"
			        }
			    });
			});
		</script>
	</body>

</html>